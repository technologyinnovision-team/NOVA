{% extends "base.html" %}

{% block title %}API Key Created - Admin Panel{% endblock %}

{% block page_title %}API Key Created Successfully{% endblock %}

{% block extra_css %}
<style>
    .copy-button:hover {
        background-color: rgba(212, 175, 55, 0.2);
    }
    .copy-success {
        animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Success Message -->
    <div class="bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/30 rounded-lg p-6 transition-theme">
        <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <div>
                <h3 class="text-lg font-semibold text-green-800 dark:text-green-300 mb-2">API Key Created Successfully!</h3>
                <p class="text-sm text-green-700 dark:text-green-400">Your API key and secret have been generated. Make sure to copy them now as the secret will not be shown again.</p>
            </div>
        </div>
    </div>
    
    <!-- API Key Details -->
    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-lg shadow-sm dark:shadow-none transition-theme">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">API Credentials</h2>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Copy these credentials and store them securely</p>
        </div>
        
        <div class="p-6 space-y-6">
            <!-- API Key -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Key</label>
                <div class="flex items-center gap-2">
                    <code class="flex-1 px-4 py-3 bg-gray-50 dark:bg-black border border-gray-300 dark:border-gray-700 rounded-lg text-sm font-mono text-gray-900 dark:text-white break-all" id="api-key-value">{{ api_key.api_key }}</code>
                    <button 
                        type="button" 
                        onclick="copyToClipboard('api-key-value', 'api-key-copy-btn')"
                        id="api-key-copy-btn"
                        class="px-4 py-3 bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg transition-colors copy-button"
                        title="Copy API Key"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    </button>
                </div>
            </div>
            
            <!-- API Secret -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    API Secret <span class="text-red-400">*</span>
                    <span class="text-xs font-normal text-gray-500 dark:text-gray-500 ml-2">(Show only once)</span>
                </label>
                <div class="bg-yellow-50 dark:bg-yellow-500/10 border border-yellow-200 dark:border-yellow-500/30 rounded-lg p-4 mb-3">
                    <div class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        <p class="text-sm text-yellow-800 dark:text-yellow-300">This is the only time you'll be able to see the API secret. Make sure to copy it now and store it securely.</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <code class="flex-1 px-4 py-3 bg-gray-50 dark:bg-black border-2 border-yellow-300 dark:border-yellow-500/50 rounded-lg text-sm font-mono text-gray-900 dark:text-white break-all" id="api-secret-value">{{ api_secret }}</code>
                    <button 
                        type="button" 
                        onclick="copyToClipboard('api-secret-value', 'api-secret-copy-btn')"
                        id="api-secret-copy-btn"
                        class="px-4 py-3 bg-yellow-100 dark:bg-yellow-500/20 hover:bg-yellow-200 dark:hover:bg-yellow-500/30 text-yellow-800 dark:text-yellow-300 rounded-lg transition-colors copy-button"
                        title="Copy API Secret"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    </button>
                </div>
            </div>
            
            <!-- API Key Info -->
            <div class="pt-4 border-t border-gray-200 dark:border-gray-800 space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Name:</span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ api_key.name }}</span>
                </div>
                {% if api_key.description %}
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Description:</span>
                    <span class="text-gray-900 dark:text-white">{{ api_key.description }}</span>
                </div>
                {% endif %}
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Created:</span>
                    <span class="text-gray-900 dark:text-white">{{ api_key.created_at.strftime('%Y-%m-%d %H:%M:%S') if api_key.created_at else 'N/A' }}</span>
                </div>
                {% if api_key.expires_at %}
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Expires:</span>
                    <span class="text-gray-900 dark:text-white">{{ api_key.expires_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                </div>
                {% else %}
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Expires:</span>
                    <span class="text-gray-900 dark:text-white">Never</span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex justify-end">
            <a href="{{ url_for('api_keys.list') }}" class="px-6 py-2.5 bg-pink hover:bg-pink-dark text-white font-medium rounded-lg transition-colors">
                Back to API Keys
            </a>
        </div>
    </div>
</div>

<script>
function copyToClipboard(elementId, buttonId) {
    const element = document.getElementById(elementId);
    const text = element.textContent;
    
    // Use modern clipboard API
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
            showCopySuccess(buttonId);
        }).catch(err => {
            console.error('Failed to copy:', err);
            fallbackCopy(text, buttonId);
        });
    } else {
        fallbackCopy(text, buttonId);
    }
}

function fallbackCopy(text, buttonId) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.opacity = '0';
    document.body.appendChild(textArea);
    textArea.select();
    
    try {
        document.execCommand('copy');
        showCopySuccess(buttonId);
    } catch (err) {
        console.error('Fallback copy failed:', err);
    }
    
    document.body.removeChild(textArea);
}

function showCopySuccess(buttonId) {
    const button = document.getElementById(buttonId);
    const originalHTML = button.innerHTML;
    button.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    button.classList.add('copy-success');
    
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.remove('copy-success');
    }, 2000);
}
</script>
{% endblock %}

